# LLM 기반 학습지도안 자동 생성 시스템 단계별 실행 가이드

## 목적 및 범위
- **목표:** PRD에 정의된 RAG+LoRA 기반 중학교 1학년 수학 학습지도안 자동 생성 시스템을 주차별·단계별로 실천 가능하도록 안내한다.
- **대상:** 프로그래밍 경험이 적은 교사·연구자가 프롬프트 중심 워크플로를 따라갈 수 있도록 구성했다.

## 단계 1: 데이터 준비
1. **자료 수집**
   - 중학교 1학년 수학 지도안 30~100개, 교육과정 문서, 기존 평가 자료를 수집한다.
   - 라이선스와 개인정보 포함 여부를 확인하고 허용된 자료만 사용한다.[^license]
2. **데이터 정제**
   - 단원명, 세부 활동, 평가 요소, 교수·학습 방법을 열로 갖는 CSV 스키마를 정의한다.
   - 폴더 내 텍스트를 하나의 CSV로 변환하는 스크립트를 LLM에게 생성 요청하고 실행해 병합한다.
3. **품질 점검**
   - 누락된 단원이나 활동이 없는지 확인하고, 샘플 몇 개를 수동으로 검토해 일관성을 확보한다.

## 단계 2: LoRA 학습 준비 및 실행 (HuggingFace AutoTrain)
1. **프로젝트 설정**
   - AutoTrain에서 "Text to Text" 프로젝트를 생성하고 베이스 모델로 Mistral-7B-Instruct 또는 Llama-3-8B를 선택한다.
2. **학습 구성**
   - CSV를 업로드하고 LoRA 옵션을 켠다.
   - 권장 하이퍼파라미터: r=16, alpha=32, dropout=0.1, 학습률 1e-4, epoch 3~5.
3. **학습 실행 및 검증**
   - 학습을 실행하고 완료된 모델의 링크를 기록한다.
   - 몇 개의 프롬프트로 스타일·서식 재현 여부를 확인한다.[^eval]

## 단계 3: RAG 검색 파이프라인 구축 (Flowise 또는 LangChain)
1. **기본 워크플로 설계**
   - 사용자 입력 → 문서 로더(PDF/Text) → 벡터스토어(Chroma) → 리트리버 → LLM 노드 흐름을 만든다.
2. **프롬프트 템플릿 준비**
   - 검색된 문단을 근거로 사용하는 지도안 생성 프롬프트를 작성하고 노드에 연결한다.
3. **검색 품질 확인**
   - 대표 주제(예: 좌표평면, 도형의 성질)로 검색해 관련 문단이 상위에 오는지 확인한다.

## 단계 4: RAG + LoRA 통합
1. **LLM 노드에 LoRA 연결**
   - Flowise LLM 노드 또는 LangChain `HuggingFacePipeline`에 학습된 LoRA 엔드포인트를 설정한다.
2. **통합 테스트**
   - 동일한 입력에 대해 RAG On/Off, LoRA On/Off 조합을 시험해 응답 품질 변화를 비교한다.
3. **프롬프트 및 검색 튜닝**
   - 검색 k 값, 프롬프트 근거 강조 문구를 조정해 정확도와 근거성을 개선한다.

## 단계 5: UI 구축 및 배포
1. **UI 초안 작성**
   - Streamlit/Replit으로 입력 폼과 결과 미리보기 컴포넌트를 구현한다.
   - RAG/LoRA 사용 여부를 토글할 수 있는 옵션을 추가한다.
2. **호스팅 및 연동**
   - Netlify(정적) 또는 Render/Replit(동적)으로 배포하고, LoRA 엔드포인트와 검색 API를 연결한다.
3. **모니터링 및 피드백 수집**
   - 쿼리, 검색 문서, 응답 로그를 저장하고 사용자 피드백 폼을 제공한다.[^monitor]

## 단계 6: 평가 및 운영 가이드
1. **정량 평가**
   - ROUGE-L, ChrF 등 자동 지표로 RAG/LoRA 조합별 결과를 비교한다.
2. **정성 평가**
   - 교사 도메인 전문가가 지도안의 적합성, 표현 스타일, 학습 목표 부합 여부를 검토한다.
3. **운영 절차**
   - 데이터 업데이트 주기, 프롬프트 개선 히스토리, 장애 대응 연락처 등을 문서화한다.

## 다음 행동 제안
- 데이터 수집 및 CSV 스키마 초안을 먼저 확정한 뒤, AutoTrain 계정을 준비하여 LoRA 학습을 바로 시작할 수 있는 상태를 만든다.
- Flowise 또는 LangChain 중 선호 도구를 결정하고, 간단한 샘플 워크플로를 구성해 검색과 생성이 동작하는지 검증한다.
- 초기 UI 프로토타입을 작성하여 핵심 통합 포인트(검색 API, LoRA 엔드포인트)를 명확히 한다.

[^license]: 교육 자료의 저작권과 개인정보 포함 여부를 선제적으로 확인해야 한다는 주의 사항이다.
[^eval]: LoRA 학습 후에는 실제 프롬프트로 출력 품질을 확인해 스타일 재현 여부를 검증해야 함을 의미한다.
[^monitor]: 운영 단계에서 로그와 사용자 피드백을 수집해 성능 저하나 오류를 조기에 발견해야 한다는 지침이다.
